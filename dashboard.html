<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Arogya-Onco | Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:'Segoe UI',sans-serif;}
body{background:#f4f6f9;color:#333;}
.hidden{display:none;}
section{padding:40px;}
button{cursor:pointer;transition:0.3s;}
input,select{padding:10px;width:100%;margin:5px 0;border-radius:8px;border:1px solid #ccc;transition:0.3s;}
input:focus, select:focus{outline:none;border-color:#2980b9;box-shadow:0 0 5px rgba(41,128,185,0.5);}

/* NAVBAR */
nav{
position:fixed;top:0;width:100%;z-index:1000;
background:#0a3d62;color:#fff;padding:15px 30px;
display:flex;justify-content:space-between;align-items:center;
box-shadow:0 5px 15px rgba(0,0,0,0.2);
}
nav ul{list-style:none;display:flex;gap:25px;}
nav li{cursor:pointer;font-weight:bold;transition:0.3s;font-size:16px;}
nav li:hover{color:#f1c40f;}

/* GRID & CARDS */
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:25px;margin-top:20px;}
.card{background:#fff;padding:30px;border-radius:15px;box-shadow:0 10px 20px rgba(0,0,0,.1);text-align:center;transition:0.3s;}
.card:hover{transform:translateY(-7px);box-shadow:0 12px 25px rgba(0,0,0,.15);}
.card h3{margin-bottom:15px;color:#0a3d62;font-size:18px;}

/* PREDICTION */
.prediction{background:#fff;padding:35px;border-radius:15px;box-shadow:0 10px 20px rgba(0,0,0,.1);}
.checkbox-group{columns:2;column-gap:20px;max-height:350px;overflow-y:auto;margin-bottom:20px;}
.result{margin-top:25px;background:#eef;padding:20px;border-radius:10px;line-height:1.6;}
.risk-bar{height:28px;width:100%;background:#ddd;border-radius:15px;overflow:hidden;margin:20px 0;}
.risk-fill{height:100%;border-radius:15px;transition:0.5s;}
.details-toggle{cursor:pointer;color:#2980b9;text-decoration:underline;margin:12px 0;display:inline-block;font-weight:bold;font-size:15px;}

/* CIVILIAN */
#civilian nav{background:#1e8449;box-shadow:0 5px 15px rgba(0,0,0,0.2);}
#civilian nav li:hover{color:#ffd700;}
.checkbox-group::-webkit-scrollbar{width:6px;}
.checkbox-group::-webkit-scrollbar-thumb{background:#2980b9;border-radius:3px;}
</style>
</head>
<body>

<!-- NAVBAR -->
<nav>
<b id="roleTitle">Dashboard</b>
<ul>
<li onclick="goTo('home')">Home</li>
<li id="predictionTab" onclick="goTo('prediction')">Prediction</li>
<li id="medicineTab" onclick="goTo('medicine')">Medicine</li>
<li id="nutritionTab" onclick="goTo('nutrition')">Nutrition</li>
<li onclick="window.close()">Logout</li>
</ul>
</nav>

<div id="content" style="margin-top:80px;"></div>

<script>
// GET ROLE
const params = new URLSearchParams(window.location.search);
const role = params.get('role');
document.getElementById('roleTitle').innerText = role.charAt(0).toUpperCase() + role.slice(1) + ' Dashboard';
if(role==='doctor'){document.getElementById('medicineTab').style.display='none';document.getElementById('nutritionTab').style.display='none';}
else{document.getElementById('predictionTab').style.display='none';}

// NAVIGATION
function goTo(id){
  const content=document.getElementById('content');
  if(id==='home'){
    if(role==='doctor'){
      content.innerHTML='<h2>Welcome Doctor</h2><div class="grid"><div class="card"><h3>Patients</h3>120</div><div class="card"><h3>High Risk</h3>18</div><div class="card"><h3>Predictions</h3>95</div><div class="card"><h3>Follow-ups</h3>12</div></div>';
    }else{
      content.innerHTML='<h2>Welcome</h2><div class="grid"><div class="card"><h3>Medicine Safety</h3></div><div class="card"><h3>Nutrition Support</h3></div><div class="card"><h3>Rural Friendly</h3></div></div>';
    }
  }else if(id==='prediction'){
    content.innerHTML=`
<div class="prediction">
<h3>Cancer Risk Prediction</h3><br>
Age: <input type="number" id="age" placeholder="Enter age"><br><br>
<div class="checkbox-group">
<b>Symptoms</b><br>
<input type="checkbox" class="s" value="10"> Weight loss<br>
<input type="checkbox" class="s" value="12"> Lump / swelling<br>
<input type="checkbox" class="s" value="10"> Persistent cough<br>
<input type="checkbox" class="s" value="15"> Bleeding<br>
<input type="checkbox" class="s" value="8"> Fatigue<br>
<input type="checkbox" class="s" value="10"> Mouth ulcer<br>
<input type="checkbox" class="s" value="12"> Difficulty swallowing<br>
<input type="checkbox" class="s" value="10"> Skin change<br>
<input type="checkbox" class="s" value="8"> Persistent fever<br>
<input type="checkbox" class="s" value="8"> Night sweats<br>
<input type="checkbox" class="s" value="10"> Pain in bones/joints<br>
<input type="checkbox" class="s" value="7"> Persistent headaches<br>
<input type="checkbox" class="s" value="15"> Blood in stool/urine<br>
<input type="checkbox" class="s" value="8"> Shortness of breath<br>
<input type="checkbox" class="s" value="8"> Unexplained bruising<br>
<input type="checkbox" class="s" value="10"> Abdominal bloating/discomfort<br>
<input type="checkbox" class="s" value="10"> Change in bowel habits<br>
<input type="checkbox" class="s" value="7"> Change in appetite<br><br>
<b>Habits / Risk Factors</b><br>
<input type="checkbox" class="h" value="15"> Smoking<br>
<input type="checkbox" class="h" value="20"> Tobacco chewing<br>
<input type="checkbox" class="h" value="10"> Alcohol<br>
<input type="checkbox" class="h" value="12"> Family history<br>
<input type="checkbox" class="h" value="10"> Pollution exposure<br>
<input type="checkbox" class="h" value="8"> Poor diet<br>
<input type="checkbox" class="h" value="8"> Sedentary lifestyle<br>
<input type="checkbox" class="h" value="10"> Obesity/high BMI<br>
<input type="checkbox" class="h" value="12"> Radiation exposure<br>
<input type="checkbox" class="h" value="15"> Chronic infections<br>
<input type="checkbox" class="h" value="8"> Hormonal therapy<br>
<input type="checkbox" class="h" value="10"> Immunosuppressive therapy<br>
<input type="checkbox" class="h" value="7"> Night shift<br>
</div><br>
<b>Blood Test Report</b><br>
Hemoglobin (g/dL): <input type="number" id="hb" placeholder="e.g., 12"><br>
WBC (10³/µL): <input type="number" id="wbc" placeholder="e.g., 6000"><br>
Platelets (10³/µL): <input type="number" id="plt" placeholder="e.g., 250"><br><br>
<button onclick="predict()">Predict Risk</button>
<button onclick="sendEmailReport()" style="margin-top:10px;">Send Report as Email</button>
<div class="risk-bar"><div id="riskFill" class="risk-fill"></div></div>
<div id="docResult" class="result"></div>
</div>`;
  }else if(id==='medicine'){
    content.innerHTML=`
<div class="card">
<h3>Medicine Originality Checker</h3><br>
<input id="batch" placeholder="Enter batch number">
<button onclick="checkMedicine()">Check</button>
<div id="medResult" class="result"></div>
</div>`;
  }else if(id==='nutrition'){
    content.innerHTML=`
<div class="card">
<h3>AI Nutrition Guidance</h3><br>
<select id="ctype">
<option>General</option>
<option>Oral Cancer</option>
<option>Breast Cancer</option>
<option>Lung Cancer</option>
</select><br><br>
<button onclick="nutrition()">Get Plan</button>
<div id="nutResult" class="result"></div>
</div>`;
  }
}

// PREDICTION FUNCTION
function predict(){
  let age=parseInt(document.getElementById("age").value||0);
  let score=0; let reasons=[];
  if(age>=40&&age<60){score+=15; reasons.push("Age above 40");}
  if(age>=60){score+=25; reasons.push("Age above 60");}
  document.querySelectorAll(".s:checked").forEach(s=>{score+=parseInt(s.value); reasons.push("Symptom: "+s.parentNode.innerText.trim());});
  document.querySelectorAll(".h:checked").forEach(h=>{score+=parseInt(h.value); reasons.push("Habit: "+h.parentNode.innerText.trim());});
  let hb=parseFloat(document.getElementById("hb").value||0);
  let wbc=parseFloat(document.getElementById("wbc").value||0);
  let plt=parseFloat(document.getElementById("plt").value||0);
  if(hb&&hb<12){score+=10; reasons.push("Low Hemoglobin");}
  if(wbc&&(wbc<4000||wbc>11000)){score+=10; reasons.push("Abnormal WBC");}
  if(plt&&(plt<150||plt>450)){score+=10; reasons.push("Abnormal Platelets");}
  if(score>100) score=100;
  let level,color;
  if(score<=30){level="LOW RISK";color="#2ecc71";}
  else if(score<=60){level="MODERATE RISK";color="#f1c40f";}
  else{level="HIGH RISK";color="#e74c3c";}
  let fill=document.getElementById("riskFill");
  fill.style.width=score+"%"; fill.style.background=color;
  let docResult=document.getElementById("docResult");
  docResult.innerHTML=`<b>Risk Score:</b> ${score}%<br>
  <b>Risk Level:</b> <span style="color:${color};font-weight:bold">${level}</span>
  <div class="details-toggle" onclick="this.nextElementSibling.classList.toggle('hidden')">Show Contributing Factors</div>
  <ul class="hidden">${reasons.map(r=>`<li>${r}</li>`).join("")}</ul>
  <small>? This is a decision-support tool, not a medical diagnosis.</small>`;
}

// EMAIL BUTTON
function sendEmailReport(){
  alert("This is gonna be integrated with Gmail API");
}

// MEDICINE CHECKER
function checkMedicine(){
  const batch=document.getElementById('batch').value;
  document.getElementById('medResult').innerText = batch.length>=6?'? Medicine appears genuine':'? Verify with pharmacist';
}

// NUTRITION (GEMINI API)
const GEMINI_API_KEY="AIzaSyBbhy6FffzzCQxa5cj-6UwnebeC_qE-ZPk";
async function nutrition(){
  const nutResult=document.getElementById("nutResult");
  const ctype=document.getElementById("ctype").value;
  nutResult.innerText="Generating AI nutrition guidance...";
  const prompt=`Give SIMPLE, SAFE, NON-DIAGNOSTIC nutrition advice for ${ctype}. Use easy rural-friendly language. No medicines. No diagnosis. Limit to 5 bullet points.`;
  try{
    const res=await fetch(`https://generativelanguage.googleapis.com/v1/models/gemini-1.5-flash:generateContent?key=${GEMINI_API_KEY}`,{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({contents:[{role:"user",parts:[{text:prompt}]}]})
    });
    const data=await res.json();
    nutResult.innerText=data.candidates[0].content.parts[0].text;
  }catch{
    nutResult.innerText="AI service unavailable. Try again later.";
  }
}

// LOAD HOME BY DEFAULT
goTo('home');
</script>

</body>
</html>
