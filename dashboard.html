<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Arogya-Onco | Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
*{box-sizing:border-box;font-family:'Segoe UI',sans-serif;margin:0;padding:0}
body{background:#f4f6f9;color:#333}

/* TOP BAR */
.topbar{
  background:#0a3d62;
  color:white;
  padding:15px 25px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.topbar h2{font-size:20px}
.topbar button{
  margin-left:10px;
  padding:8px 16px;
  border:none;
  border-radius:8px;
  cursor:pointer;
  font-weight:600;
}
.emailBtn{background:#2a9d8f;color:white}
.logoutBtn{background:#e63946;color:white}

/* NAVBAR */
.navbar{display:flex;gap:15px;margin-top:10px}
.navbar button{
  background:#264653;color:white;padding:10px 16px;border:none;border-radius:8px;cursor:pointer;font-weight:600;transition:0.3s;
}
.navbar button:hover{background:#1b3a4b}

/* CONTENT GRID */
.container{padding:20px}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:20px}

/* CARD */
.card{
  background:white;
  border-radius:16px;
  padding:20px;
  box-shadow:0 10px 25px rgba(0,0,0,0.08);
}
.card h3{color:#0a3d62;margin-bottom:10px}

/* CHECKBOX */
.check-item{
  display:flex;
  align-items:center;
  gap:12px;
  margin:8px 0;
  cursor:pointer;
}
.check-item input{display:none}
.custom-check{
  width:22px;height:22px;
  border-radius:6px;
  border:2px solid #2a9d8f;
  display:flex;
  align-items:center;
  justify-content:center;
}
.custom-check::after{
  content:"?";
  color:white;
  font-size:14px;
  display:none;
}
.check-item input:checked + .custom-check{
  background:#2a9d8f;
}
.check-item input:checked + .custom-check::after{
  display:block;
}

/* BLOOD INPUT */
.card input{
  width:100%;
  padding:10px;
  margin-bottom:10px;
  border-radius:8px;
  border:1px solid #ccc;
}

/* RESULT */
.result{
  margin-top:30px;
  background:linear-gradient(135deg,#f8f9fa,#e9ecef);
  padding:25px;
  border-radius:20px;
  text-align:center;
}
#riskText{font-weight:bold;font-size:18px;margin-bottom:12px}
.risk-bar{
  background:#ddd;
  height:28px;
  border-radius:15px;
  overflow:hidden;
}
.risk-fill{
  height:100%;
  width:0%;
  border-radius:15px;
  transition:width 1s;
}
.result button{
  padding:12px 25px;
  margin-top:15px;
  border:none;
  border-radius:10px;
  background:#e76f51;
  color:white;
  font-size:16px;
  cursor:pointer;
}
.result button:hover{opacity:0.9}
</style>
</head>
<body>

<!-- TOPBAR -->
<div class="topbar">
  <h2 id="roleTitle">Dashboard</h2>
  <div>
    <button class="emailBtn" onclick="sendEmail()">Email</button>
    <button class="logoutBtn" onclick="logout()">Logout</button>
  </div>
</div>

<!-- NAVIGATION -->
<div class="navbar" id="navbar"></div>

<!-- CONTENT -->
<div class="container" id="content"></div>

<script>
/* ========================
   ROLE DETECTION
======================== */
const params = new URLSearchParams(window.location.search);
const role = params.get('role') || 'civilian';
document.getElementById('roleTitle').innerText = role.charAt(0).toUpperCase() + role.slice(1) + " Dashboard";

/* ========================
   NAVBAR SETUP
======================== */
const navbar = document.getElementById('navbar');
if(role==='doctor'){
  navbar.innerHTML = `
    <button onclick="goTo('home')">Home</button>
    <button onclick="goTo('prediction')">Prediction</button>
  `;
}else{
  navbar.innerHTML = `
    <button onclick="goTo('home')">Home</button>
    <button onclick="goTo('medicine')">Medicine</button>
    <button onclick="goTo('nutrition')">Nutrition</button>
  `;
}

/* ========================
   NAVIGATION FUNCTION
======================== */
function goTo(id){
  const content = document.getElementById('content');

  if(role==='doctor'){
    if(id==='medicine' || id==='nutrition'){alert("Access Restricted"); return;}
  } else {
    if(id==='prediction'){alert("Doctors Only"); return;}
  }

  if(id==='home'){
    content.innerHTML = role==='doctor'
      ? `<h2>Welcome Doctor</h2>
         <div class="grid">
           <div class="card"><h3>Patients</h3>120</div>
           <div class="card"><h3>High Risk</h3>18</div>
           <div class="card"><h3>Predictions</h3>95</div>
           <div class="card"><h3>Follow-ups</h3>12</div>
         </div>`
      : `<h2>Welcome</h2>
         <div class="grid">
           <div class="card"><h3>Medicine Safety</h3></div>
           <div class="card"><h3>Nutrition Support</h3></div>
           <div class="card"><h3>Rural Friendly</h3></div>
         </div>`;
  }

  if(id==='prediction'){loadPredictionUI();}
  if(id==='medicine'){loadMedicineUI();}
  if(id==='nutrition'){loadNutritionUI();}
}

/* ========================
   PREDICTION UI
======================== */
function loadPredictionUI(){
  const content = document.getElementById('content');
  content.innerHTML = `
<h2>Cancer Risk Prediction</h2>
<div class="grid">

<div class="card">
<h3>Symptoms</h3>
${[
"Unexplained weight loss","Persistent fatigue","Chronic pain","Lump or swelling",
"Unusual bleeding","Difficulty swallowing","Persistent cough","Changes in bowel habits",
"Skin changes","Night sweats","Mouth ulcers","Bone/joint pain","Headaches"
].map(sym=>`
<label class="check-item"><input type="checkbox"><div class="custom-check"></div><span>${sym}</span></label>`).join('')}
</div>

<div class="card">
<h3>Habits</h3>
${[
"Smoking","Alcohol consumption","Tobacco chewing","Poor diet","Lack of exercise",
"Obesity","High stress","Radiation exposure","Family history",
"Night shift","Hormonal therapy","Chronic infections"
].map(hab=>`
<label class="check-item"><input type="checkbox"><div class="custom-check"></div><span>${hab}</span></label>`).join('')}
</div>

<div class="card">
<h3>Blood Report</h3>
<input placeholder="Hemoglobin (g/dL)">
<input placeholder="WBC Count">
<input placeholder="Platelet Count">
<input placeholder="RBC Count">
<input placeholder="ESR">
</div>

</div>

<div class="result">
<h2>Combined Risk Result</h2>
<div id="riskText">—</div>
<div class="risk-bar">
  <div id="riskFill" class="risk-fill"></div>
</div>
<button onclick="predict()">Predict Risk</button>
<small>This is a decision-support tool, not a diagnosis.</small>
</div>
`;
}

/* ========================
   MEDICINE UI
======================== */
function loadMedicineUI(){
  const content = document.getElementById('content');
  content.innerHTML = `
<div class="card">
<h3>Medicine Originality Checker</h3>
<input placeholder="Enter batch number">
<button onclick="checkMedicine()">Check</button>
<h3 id="medResult">—</h3>
</div>`;
}

/* ========================
   NUTRITION UI
======================== */
function loadNutritionUI(){
  const content = document.getElementById('content');
  content.innerHTML = `
<div class="card">
<h3>AI Nutrition Guidance</h3>
<select id="ctype">
<option>General</option>
<option>Oral Cancer</option>
<option>Breast Cancer</option>
<option>Lung Cancer</option>
</select>
<button onclick="nutrition()">Get Plan</button>
<div id="nutResult" style="margin-top:10px"></div>
</div>`;
}

/* ========================
   PREDICTION LOGIC
======================== */
function predict(){
  let score=0;

  document.querySelectorAll('input[type="checkbox"]:checked').forEach(cb=>{
    const type = cb.closest('.card').querySelector('h3').innerText;
    score += type==="Symptoms"?8:6;
  });

  const inputs = document.querySelectorAll('.card input');
  const hb = parseFloat(inputs[0].value||0);
  const wbc = parseFloat(inputs[1].value||0);
  const plt = parseFloat(inputs[2].value||0);
  const rbc = parseFloat(inputs[3].value||0);
  const esr = parseFloat(inputs[4].value||0);

  if(hb && hb<12) score+=10;
  if(wbc && (wbc<4000||wbc>11000)) score+=10;
  if(plt && (plt<150||plt>450)) score+=10;
  if(rbc && rbc<4) score+=8;
  if(esr && esr>20) score+=8;

  if(score>100) score=100;

  let level="", color="";
  if(score<=30){level="LOW RISK";color="#2ecc71";}
  else if(score<=65){level="MODERATE RISK";color="#f1c40f";}
  else{level="HIGH RISK";color="#e74c3c";}

  const fill = document.getElementById("riskFill");
  document.getElementById("riskText").innerText = `${level} (${score}%)`;
  fill.style.background = color;
  fill.style.width = "0%";
  setTimeout(()=>{fill.style.width = score+"%";},50);
}

/* ========================
   EXTRA FUNCTIONS
======================== */
function logout(){window.location.href="index.html";}
function sendEmail(){alert("Email API integration placeholder");}
function checkMedicine(){
  const batch = document.querySelector('input[placeholder="Enter batch number"]').value;
  document.getElementById('medResult').innerText = batch.length>=6?'Medicine appears genuine':'Verify with pharmacist';
}

/* ========================
   GEMINI API NUTRITION
======================== */
const GEMINI_API_KEY = "AIzaSyBbhy6FffzzCQxa5cj-6UwnebeC_qE-ZPk"; // Replace with your key

async function nutrition(){
  const nutResult = document.getElementById("nutResult");
  const ctype = document.getElementById("ctype").value;
  nutResult.innerText = "Generating AI nutrition guidance...";

  const prompt = `Give SIMPLE, SAFE, NON-DIAGNOSTIC nutrition advice for ${ctype}. 
Use easy rural-friendly language. No medicines. No diagnosis. Limit to 5 bullet points.`;

  try {
    const response = await fetch(`https://generativelanguage.googleapis.com/v1/models/gemini-1.5-flash:generateContent?key=${GEMINI_API_KEY}`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        prompt: prompt,
        temperature: 0.7,
        maxOutputTokens: 300
      })
    });

    const data = await response.json();
    const text = data?.candidates?.[0]?.content?.[0]?.text || "No response from AI";
    nutResult.innerText = text;
  } catch (err) {
    nutResult.innerText = "AI service unavailable. Try again later.";
    console.error(err);
  }
}

/* ========================
   LOAD DEFAULT PAGE
======================== */
goTo('home');
</script>

</body>
</html>
